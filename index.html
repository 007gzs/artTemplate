<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8' />
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<meta name="description" content="artTemplate : JavaScript Template Engine" />
<link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">
<title>artTemplate</title>
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-32376609-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</head>

<body>

<!-- HEADER -->
<div id="header_wrap" class="outer">
  <div class="inner"> <a id="forkme_banner" href="https://github.com/aui/artTemplate">View on GitHub</a>
    <h1 id="project_title">artTemplate</h1>
    <h2 id="project_tagline">JavaScript Template Engine</h2>
    <div id="downloads"> <a class="zip_download_link" href="https://github.com/aui/artTemplate/zipball/master">Download this project as a .zip file</a> <a class="tar_download_link" href="https://github.com/aui/artTemplate/tarball/master">Download this project as a tar.gz file</a> </div>
  </div>
</div>

<!-- MAIN CONTENT -->
<div id="main_content_wrap" class="outer">
  <div id="main_content" class="inner">
    <h1><strong>artTemplate</strong></h1>
    <p>artTemplate 是新一代 javascript 模板引擎，它采用预编译方式让性能有了质的飞跃，并且充分利用 javascript 引擎特性，使得其性能无论在前端还是后端都有极其出色的表现。在 chrome 下渲染效率测试中分别是知名引擎 Mustache 与 micro tmpl 的 25 、 32 倍。</p>
    <p>除了性能优势外，调试功能也值得一提。模板调试器可以精确定位到引发渲染错误的模板语句，解决了编写模板过程中无法调试的痛苦，让开发变得高效，也避免了因为单个模板出错导致整个应用崩溃的情况发生。</p>
    <p>artTemplate 这一切都在 1.7kb(gzip) 中实现！</p>
    <h2>快速上手</h2>
    <h3>模板语法</h3>
    <p>模板逻辑语法默认采用原生的 javascript 语法，与微型模板引擎 tmpl 保持一致。</p>
    <p>模板逻辑语法开始与结束的界定符号为"&lt;%" 与 "%&gt;"，"&lt;%"后面紧跟"="号则输出变量内容，如：</p>
    <pre>&lt;ul&gt;
    &lt;% for (i = 0; i &lt; list.length; i ++) { %&gt;
        &lt;li&gt;条目内容 &lt;%= i + 1 %&gt; ：&lt;%= list[i] %&gt;&lt;/li&gt;
    &lt;% } %&gt;
&lt;/ul&gt;</pre>
    <h3>定义模板 </h3>
    <p>(1) 页面中 type="text/html" 的脚本标签会被浏览器忽略，可以不用考虑转义也能分行书写模板。</p>
    <p>例如定义一个 ID 为 "t-list" 的模板：</p>
    <pre>&lt;script id="t-list" type="text/html"&gt;
&lt;ul&gt;
    &lt;% for (i = 0; i &lt; list.length; i ++) { %&gt;
        &lt;li&gt;条目内容 &lt;%= i + 1 %&gt; ：&lt;%= list[i] %&gt;&lt;/li&gt;
    &lt;% } %&gt;
&lt;/ul&gt;
&lt;/script&gt;   </pre>
    <p>(2) 如果想在脚本文件中存放模板，可以使用 template 方法定义模板，如：</p>
    <pre>var render = template('&lt;% for (var i in names) { %&gt;&lt;%=name[i]%&gt;&lt;% } %&gt;');
var html = render(data);//渲染</pre>
    <p> 或者： </p>
    <pre>template('t-test', '&lt;% for (var i in names) { %&gt;&lt;%=name[i]%&gt;&lt;% } %&gt;');</pre>
    <h3>渲染模板</h3>
    <p>如果 template 第二个参数为 Ojbect 类型，则表示渲染模板：</p>
    <pre>var html = template('t-list', {
    list: ['文艺', '博客', '摄影', '电影', '民谣', '旅行', '吉他']
});</pre>
    <p>以上就是 artTemplate 的基本功能使用，接下来是高级功能介绍。</p>
    <h2>扩展方法</h2>
    <p>artTemplate 的模板语句将会在沙箱中执行，此时模板语句无法读写外部对象（甚至使用内联函数 this 访问全局也被禁止），若让模板访问公用数据与方法可以使用 template.method() 接口进行定义。</p>
    <p>扩展方法一般用来进行字符串替换，如XSS过滤、UBB替换、脏话替换等。例如扩展一个XSS过滤方法：</p>
    <pre>template.method('escapeHTML', (function () {

    var rHtml = /&amp;(?!\w+;)|[&lt;&gt;"']/g;
    var map = {
        "&amp;": "&amp;amp;",
        "&lt;": "&amp;lt;",
        "&gt;": "&amp;gt;",
        '"': "&amp;quot;",
        "'": "&amp;#39;"
    };
    
    var fn = function (s) {
        return map[s] || s;
    };
    
    return function (content) {
        return typeof content === 'string'
        ? content.replace(rHtml, fn)
        : content;
    };

})());</pre>
    <p>在模板中的使用方式：</p>
    <pre>&lt;%= escapeHTML(content) %&gt;</pre>
    <p>模板中已经内置模板包含方法：</p>
    <p>include(id, [data])            data 参数可选，默认为传入当前模板数据</p>
    <h2>自定义界定符</h2>
    <p>若前端模板语法与后端语法产生冲突，可以修改模板引擎界定符，例如：</p>
    <pre>template.openTag = "&lt;!--[";
template.closeTag = "]--&gt;";</pre>
    <h2>自定义语法</h2>
    <p>若想使用更加简洁的模板逻辑语法，把语法库 <a href="template-statement.js">template-statement.js</a> 合并到 <a href="template.js">template.js</a> 即可使用新语法，此时界定符号改为 "{" 与 "}"，新语法示例：</p>
    <pre>{if title}<br>    &lt;h3&gt;{echo title}&lt;/h3&gt;<br>    &lt;ul&gt;<br>        {each list as val i}<br>            &lt;li&gt;条目内容 {echo i + 1} ：{echo val}&lt;/li&gt;<br>        {/each}<br>    &lt;/ul&gt;<br>{/if}</pre>
    <h3>支持的语句：</h3>
    <ul>
      <li> <strong>条件</strong>：{if ...} {else if ...} {else} {/if}</li>
      <li> <strong>遍历</strong>：{each ...} {/each}</li>
      <li> <strong>输出</strong>：{echo ...}</li>
      <li> <strong>包含</strong>：{include ...}</li>
    </ul>
    artTemplate 引擎支持自由扩展语法，请参考 <a href="template-statement.js">template-statement.js</a> 举一反三。
    <h2>模板语法规范</h2>
    <p>1、不能使用 javascript 关键字作为模板变量，包括 ECMA5 严格模式下新增的关键字: </p>
    <pre>break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in
,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with
   
,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto
,implements,import,int,interface,long,native,package,private,protected,public,short
,static,super,synchronized,throws,transient,volatile
 
,arguments,let,yield</pre>
    <p>2、不能读写全局变量，除非给模板定义扩展方法。</p>
    <h2>自动化打包工具</h2>
    <p> 有时候考虑到模板复用或者需要异步加载，可以使用 tools 目录下的自动化合并工具，有 HTML 与批处理两个版本。其中批处理版本可以把页面内嵌的模板抽取出来在同目录生成对应的 js 文件，以便使用 seajs 等脚本加载器异步加载。 </p>
    <h2>与 tmpl 兼容</h2>
    <p> artTemplate 可以通过简单的设置兼容 john 开发的 tmpl 微型模板引擎： </p>
    <pre>var tmpl = template;
template.method('tmpl', template.render);</pre>
    <p>这样可以由 tmpl 平滑迁移到 artTemplate，并原来 tmpl 模板中的套嵌仍然有效，同时也解决了 tmpl 模板不能包含单引号与反斜杠的 BUG。</p>
    <p>需要注意的地方：tmpl 模板中原来引用的全局变量会因为 artTemplate 沙箱机制导致无法访问，需要通过 template.method() 方法进行定义。</p>
    <h2>演示</h2>
    <ul>
      <li><a href="./test/test.html">基本例子</a></li>
      <li><a href="./test/test-include.html">嵌入子模板</a></li>
      <li><a href="./test/test-method.html">扩展方法</a></li>
      <li><a href="./test/test-statement.html">自定义语法</a></li>
      <li><a href="./test/test-debug.html">错误调试</a></li>
      <li><a href="./test/test-statement-debug.html">错误调试[自定义语法]</a></li>
      <li><a href="./test/test-tag.html">自定义界定符</a></li>
      <li><a href="./test/test-undefined.html">未定义数据输出</a></li>
      <li><a href="./test/test-tmpl.html">与tmpl兼容</a></li>
      <li><a href="./test/test-compiled.html">编译原理</a></li>
      <li><a href="./test/test-speed.html">引擎渲染速度竞赛</a></li>
    </ul>
  </div>
</div>

<!-- FOOTER  -->
<div id="footer_wrap" class="outer">
  <div class="inner">
    <p class="copyright">作者: <a href="http://www.planeart.cn">糖饼</a>, 崇尚简单极致的编程体验, 交流: <a href="http://t.qq.com">腾讯微博</a> <a href="http://weibo.com/planeart">新浪微博</a></p>
    <p>&copy; 2012 cdc.tencent.com, Published with <a href="http://pages.github.com">GitHub Pages</a></p>
  </div>
</div>
</body>
</html>
